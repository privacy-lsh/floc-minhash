This directory contains the evaluation of our attacks on FLoC.

For more details about the metrics used please refer to the thesis available [here](https://www.research-collection.ethz.ch/handle/20.500.11850/539945).

## Directory Structure

Some files that take time to compute may be saved and reused. 
It should be the case that if the folder where the file should be saved does not exist, it is created.
However, it may still happen that the program crashes if the filepath has not been created beforehand.

A non-exhaustive list of the folder structure can be found below.
``` 
evaluation
├── logs
│   ├── somelogfilename.log
│   └── ...
├── saved
│   ├── cluster_assignments
│   │   ├── generated
│   │   │   └── ...
│   │   └── real
│   │       └── ...
│   ├── floc-whitepaper-features.npy
│   ├── ...
├── anonymity_evaluation.py
├── pairwise_cosine_similarity.py
├── pipeline.py
├── README.md
└── wasserstein_distance.py
```
## Main files description

* `anonymity_evaluation.py` tries to reproduce the results from Fig 4b in the Google FLoC [whitepaper](https://github.com/google/ads-privacy/blob/master/proposals/FLoC/FLOC-Whitepaper-Google.pdf).
It also tries different parameters and add the plot for the user generated by the GAN.
  * After running `anonymity_evaluation.py` with appropriate parameters, some cluster files should have been generated, and it is possible to run `pairwise_cosine_similarity.py` to gain more insight about some of the pairwise cosine similarity matrices between generated and real users mapped to the same SimHash cluster. It also reports some common movies and genres metrics. 

* `pipeline.py` contains the code for the attack (and its evaluation) using the GAN to generate plausible user histories, followed by an integer program to match a target SimHash, with the possibility to use the GAN's discriminator on the resulting history. It reports the common movie and minimum Hamming distance metrics.

* `wasserstein_distance.py` computes the one-dimensional wasserstein distance between the generated and test movie distributions.



###### Miscellaneous
Some of the code may have only be run with JetBrains PyCharm's Python Console, since it provides variables preview and inspection features.
However, when disabled some code may not run properly since it seems some variables' scope changed with the use of the Python console.

In addition, when using Python multiprocessing with Pycharm's Python console they may be some problems with function that 
could not be pickled. Nevertheless, disabling the Python console could remove the issue with pickle.
